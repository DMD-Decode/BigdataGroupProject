# 🗂️ 데이터 파이프라인 및 정규화 문서

본 문서는 **Bigdata_HW 프로젝트의 ETL 처리 과정, 정규화 규칙, 파이프라인 구조, 데이터 저장 방식, 개발 과정에서의 문제 및 해결**을 최신 기준(2025년 데이터, Parquet 반영, API 미사용)에 맞추어 정리한 최종 문서입니다.

---

# 1. 📦 전체 데이터 파이프라인 개요

데이터 파이프라인은 아래 구조로 동작한다.

1. **원본 데이터 수집**

   - 관광 데이터: CSV/XLS (입국·출국)
   - 환율 데이터: 일별 CSV
   - **📌 API는 사용하지 않음 (안정성 문제로 제거)**

2. **전처리(정규화)**

   - 국가명 정규화
   - 파일명 기반 통화코드 추출
   - 월별 Aggregation
   - 헤더 복구 및 컬럼 매핑

3. **정제(클린징)**

   - 결측치 처리
   - 잘못된 헤더 제거
   - 데이터 타입 변환

4. **저장**

   - 모든 최종 데이터는 **Parquet 형식**으로 저장
   - 관광: 2025년 7월까지
   - 환율: 2025년 10월까지

5. **분석 및 시각화**
   - 피어슨 상관계수
   - 시계열 월별 정렬
   - Plotly / Seaborn 기반 대시보드

---

# 2. 🛠️ 핵심 기술 스택

| 범주          | 사용 기술        | 반영된 특징              |
| ------------- | ---------------- | ------------------------ |
| 웹 프레임워크 | Streamlit        | UI/인터랙티브 대시보드   |
| 데이터 처리   | pandas, numpy    | Parquet 기반 고속 로딩   |
| 시계열 처리   | pandas resample  | 일별 → 월별 평균         |
| 시각화        | plotly, seaborn  | 이중축, Heatmap          |
| 파일 처리     | glob, pathlib    | CSV/XLS 자동 수집        |
| API           | — ❌(사용 안 함) | 원본 파일 100% 로컬 처리 |

---

# 3. 📁 데이터 정규화 규칙

## 3.1 Inbound (입국)

- 원본은 연도·국가가 전치된 상태 → **Transpose 수행**
- 한글 컬럼 제거 후 영문 코드 매핑
- 국가명 불일치 제거 (예: “미국(USA)” → “USA”)
- 월별 데이터 정렬
- **최종 저장: inbound.parquet (2025.07까지)**

## 3.2 Outbound (출국)

- 원본이 복합 헤더 구조  
  → 1행·2행 결합하여 재구성
- 국가명 텍스트 클린업
- 월별 값 integer 변환
- **최종 저장: outbound.parquet**

## 3.3 Exchange (환율)

- 파일명에서 **통화코드 자동 추출**  
  예: `USD_2020.csv` → USD
- 일별 데이터 → 월별 평균(`resample('MS').mean()`)
- 타임존·포맷 자동 정리
- **최종 저장: exchange.parquet (2025.10까지)**

---

# 4. ⚠️ 개발 중 발생한 문제와 해결

| 문제                       | 원인                           | 최종 해결                                   |
| -------------------------- | ------------------------------ | ------------------------------------------- |
| API 불안정(응답 지연·다운) | 외부 서비스 의존성             | **API 완전 제거 → 로컬 파일만 사용**        |
| 데이터 기간 불일치         | 환율(2025.10) vs 관광(2025.07) | **Inner Join → 공통월(2025.07)까지만 분석** |
| header 깨짐/인코딩 문제    | 여러 기관 데이터 혼합          | `utf-8-sig → cp949` fallback 적용           |
| 원본 구조 제각각           | 파일 포맷 상이                 | 전처리 모듈 분리(processors)로 통일         |
| 로딩 속도 저하             | CSV 반복 파싱                  | **Parquet 도입으로 해결**                   |

---

# 5. 📂 프로젝트 디렉터리 구조 (최신 통합본)

## Root 구조

```text
root/
├── app.py                          # Streamlit 메인 애플리케이션
├── utils.py                        # 공통 함수 및 데이터 로딩 유틸
├── README.md                       # 프로젝트 최상위 문서
│
├── data/                           # 데이터 및 ETL 전체 관리 디렉터리
│   ├── main.py                     # ETL 전체 실행 스크립트
│   ├── file_organizer.py           # 디렉터리/파일 자동 정리 모듈
│   ├── xls_converter.py            # XLS/XLSX → CSV 변환 스크립트
│   ├── README.md                   # 데이터 처리/전처리 관련 상세 설명
│   │
│   ├── original_data/              # 원본 데이터 (CSV/XLS/XLSX)
│   ├── cleaned_data/               # 전처리 완료된 Parquet/CSV 파일
│   │
│   └── processors/                 # 데이터 전처리 모듈 모음
│       ├── __init__.py             # 패키지 초기화 파일
│       ├── common.py               # 공통 전처리 유틸 함수
│       ├── exchange.py             # 환율 데이터 전처리
│       ├── inbound.py              # 입국(방한) 관광 데이터 전처리
│       ├── outbound.py             # 출국 관광 데이터 전처리
│       └── __pycache__/            # Python 캐시 파일
│
└── views/                          # Streamlit UI 페이지 모듈
    ├── dashboard.py                # 메인 현황판 (KPI + 요약 그래프)
    ├── inbound.py                  # 방한 관광 분석 페이지
    ├── outbound.py                 # 출국 관광 분석 페이지
    ├── exchange.py                 # 환율 분석 페이지
    └── correlation.py              # 관광객 ↔ 환율 상관관계 분석 페이지

```
